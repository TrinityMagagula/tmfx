<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TM FX TRADING PTY LTD - Admin Dashboard</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            padding-bottom: 60px;
        }
        
        header {
            background-color: #1e3a8a;
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            gap: 2rem;
        }
        
        .form-container, .signals-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            width: 100%;
            max-width: 1000px;
        }
        
        h1 {
            margin-bottom: 1rem;
            color: white;
        }
        
        h2 {
            margin-bottom: 1.5rem;
            color: #1e3a8a;
            text-align: center;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4b5563;
        }
        
        input, select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .full-width {
            grid-column: span 2;
        }
        
        .submit-btn {
            background-color: #1e3a8a;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 1rem;
        }
        
        .submit-btn:hover {
            background-color: #1d4ed8;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .alert-success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .alert-error {
            background-color: #fee2e2;
            color: #b91c1c;
            border: 1px solid #fca5a5;
        }
        
        /* Signals table styles */
        .signals-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .signals-table th, .signals-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .signals-table th {
            background-color: #f3f4f6;
            font-weight: 600;
            color: #374151;
        }
        
        .signals-table tr:hover {
            background-color: #f9fafb;
        }
        
        .result-select {
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #d1d5db;
        }
        
        .result-select:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        footer {
            text-align: center;
            padding: 1rem;
            background-color: #1e3a8a;
            color: white;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>
    <header>
        <h1>TM FX TRADING PTY LTD</h1>
        <p>Admin Dashboard - Trading Signals</p>
    </header>
    
    <div class="main-container">
        <div class="form-container">
            <h2>Add New Trading Signal</h2>
            
            <div id="alert-success" class="alert alert-success">
                Signal successfully added to the database!
            </div>
            
            <div id="alert-error" class="alert alert-error">
                Error occurred while saving the signal. Please try again.
            </div>
            
            <form id="signal-form" class="form-grid">
                <div class="form-group">
                    <label for="market">Market</label>
                    <select id="market" name="market" required>
                        <option value="">Select Market</option>
                        <option value="DERIV">DERIV</option>
                        <option value="FOREX">FOREX</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="symbol">Symbol</label>
                    <input type="text" id="symbol" name="symbol" required>
                </div>
                
                <div class="form-group">
                    <label for="action">Action</label>
                    <select id="action" name="action" required>
                        <option value="">Select Action</option>
                        <option value="BUY">BUY</option>
                        <option value="SELL">SELL</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="entry">Entry Price</label>
                    <input type="number" id="entry" name="entry" step="0.00001" required>
                </div>
                
                <div class="form-group">
                    <label for="sl">Stop Loss (SL)</label>
                    <input type="number" id="sl" name="sl" step="0.00001" required>
                </div>
                
                <div class="form-group">
                    <label for="tp">Take Profit (TP)</label>
                    <input type="number" id="tp" name="tp" step="0.00001" required>
                </div>
                
                <div class="form-group">
                    <label for="timeframe">Timeframe</label>
                    <select id="timeframe" name="timeframe" required>
                        <option value="">Select Timeframe</option>
                        <option value="1m">1 Minute</option>
                        <option value="5m">5 Minutes</option>
                        <option value="15m">15 Minutes</option>
                        <option value="30m">30 Minutes</option>
                        <option value="1h">1 Hour</option>
                        <option value="4h">4 Hours</option>
                        <option value="1d">1 Day</option>
                        <option value="1w">1 Week</option>
                        <option value="1M">1 Month</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <label for="reason">Reason</label>
                    <input type="text" id="reason" name="reason" required>
                </div>
                
                <div class="form-group">
                    <label for="confidence">Confidence</label>
                    <select id="confidence" name="confidence" required>
                        <option value="">Select Confidence</option>
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="expiry">Expiry</label>
                    <select id="expiry" name="expiry" required>
                        <option value="">Select Expiry</option>
                        <option value="End of Day">End of Day</option>
                        <option value="End of Week">End of Week</option>
                        <option value="End of Month">End of Month</option>
                        <option value="Open">Open</option>
                    </select>
                </div>
                
                <div class="form-group full-width">
                    <button type="submit" class="submit-btn">Submit Signal</button>
                </div>
            </form>
        </div>
        
        <div class="signals-container">
            <h2>Recent Trading Signals</h2>
            <div id="signals-table-container">
                <table class="signals-table">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Action</th>
                            <th>Entry</th>
                            <th>SL</th>
                            <th>TP</th>
                            <th>Timeframe</th>
                            <th>Date</th>
                            <th>Result</th>
                        </tr>
                    </thead>
                    <tbody id="signals-table-body">
                        <!-- Signals will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <footer>
        &copy; 2023 TM FX TRADING PTY LTD. All rights reserved.
    </footer>
    
    <script>
        // Wait for the DOM to be fully loaded before initializing Supabase
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Supabase client
            const supabaseUrl = 'https://fepujhdzovzbygczdjxe.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZlcHVqaGR6b3Z6YnlnY3pkanhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwODE2MDUsImV4cCI6MjA2MTY1NzYwNX0.mVNDZaHTodnQQ3EGvUS3puaAfTKsiyRCSGldOo_wFmU';
            const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

            // Load signals when page loads
            loadSignals();
            
            // Form submission handler
            document.getElementById('signal-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Hide any previous alerts
                document.getElementById('alert-success').style.display = 'none';
                document.getElementById('alert-error').style.display = 'none';
                
                // Get form values
                const market = document.getElementById('market').value;
                const symbol = document.getElementById('symbol').value;
                const action = document.getElementById('action').value;
                const entry = parseFloat(document.getElementById('entry').value);
                const sl = parseFloat(document.getElementById('sl').value);
                const tp = parseFloat(document.getElementById('tp').value);
                const timeframe = document.getElementById('timeframe').value;
                const reason = document.getElementById('reason').value;
                const confidence = document.getElementById('confidence').value;
                const expiry = document.getElementById('expiry').value;
                
                try {
                    // Insert data into Supabase
                    const { data, error } = await supabase
                        .from('Signals')
                        .insert([
                            { 
                                Market: market,
                                Symbol: symbol,
                                Action: action,
                                Entry: entry,
                                Sl: sl,
                                Tp: tp,
                                Timeframe: timeframe,
                                Reason: reason,
                                Confidence: confidence,
                                Expiry: expiry
                            }
                        ]);
                    
                    if (error) throw error;
                    
                    // Show success message
                    document.getElementById('alert-success').style.display = 'block';
                    
                    // Reset form
                    document.getElementById('signal-form').reset();
                    
                    // Reload signals to show the new one
                    loadSignals();
                    
                    // Hide success message after 5 seconds
                    setTimeout(() => {
                        document.getElementById('alert-success').style.display = 'none';
                    }, 5000);
                    
                } catch (error) {
                    console.error('Error inserting data:', error);
                    document.getElementById('alert-error').style.display = 'block';
                    
                    // Hide error message after 5 seconds
                    setTimeout(() => {
                        document.getElementById('alert-error').style.display = 'none';
                    }, 5000);
                }
            });
            
            // Function to load signals from Supabase
            async function loadSignals() {
                try {
                    const { data: signals, error } = await supabase
                        .from('Signals')
                        .select('*')
                        .order('Date', { ascending: false });
                    
                    if (error) throw error;
                    
                    const tableBody = document.getElementById('signals-table-body');
                    tableBody.innerHTML = '';
                    
                    signals.forEach(signal => {
                        const row = document.createElement('tr');
                        
                        // Format the date for display
                        const date = new Date(signal.Date);
                        const formattedDate = date.toLocaleString();
                        
                        row.innerHTML = `
                            <td>${signal.Symbol}</td>
                            <td>${signal.Action}</td>
                            <td>${signal.Entry}</td>
                            <td>${signal.Sl}</td>
                            <td>${signal.Tp}</td>
                            <td>${signal.Timeframe}</td>
                            <td>${formattedDate}</td>
                            <td>
                                <select class="result-select" data-id="${signal.no}" onchange="updateResult(this)">
                                    <option value="">Select Result</option>
                                    <option value="Active" ${signal.Results === 'Active' ? 'selected' : ''}>Active</option>
                                    <option value="Good" ${signal.Results === 'Good' ? 'selected' : ''}>Good</option>
                                    <option value="Bad" ${signal.Results === 'Bad' ? 'selected' : ''}>Bad</option>
                                </select>
                            </td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                    
                } catch (error) {
                    console.error('Error loading signals:', error);
                }
            }
            
            // Make loadSignals available globally so it can be called from the select's onchange
            window.loadSignals = loadSignals;
        });
        
        // Function to update result (needs to be global for the select's onchange)
        async function updateResult(selectElement) {
            const signalId = selectElement.getAttribute('data-id');
            const result = selectElement.value;
            
            if (!result) return; // Don't update if no result selected
            
            const supabaseUrl = 'https://fepujhdzovzbygczdjxe.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZlcHVqaGR6b3Z6YnlnY3pkanhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwODE2MDUsImV4cCI6MjA2MTY1NzYwNX0.mVNDZaHTodnQQ3EGvUS3puaAfTKsiyRCSGldOo_wFmU';
            const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
            
            try {
                const { data, error } = await supabase
                    .from('Signals')
                    .update({ Results: result })
                    .eq('no', signalId);
                
                if (error) throw error;
                
                console.log('Result updated successfully');
                
            } catch (error) {
                console.error('Error updating result:', error);
                // Revert the select to its previous value
                selectElement.value = '';
            }
        }
    </script>
</body>
</html>